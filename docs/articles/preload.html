<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Workflows and Preloading Content • formods</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Workflows and Preloading Content">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">formods</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-chalkboard-teacher"></span> Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../articles/included_modules.html">Included Modules</a></li>
    <li><a class="dropdown-item" href="../articles/making_modules.html">Making Modules</a></li>
    <li><a class="dropdown-item" href="../articles/preload.html">Automating Workflows and Preloading Content</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fas fa-hat-wizard"></span> Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html"><span class="fa fas fa-rss"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/john-harrold/formods/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Workflows and Preloading Content</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/john-harrold/formods/blob/HEAD/vignettes/preload.Rmd" class="external-link"><code>vignettes/preload.Rmd</code></a></small>
      <div class="d-none name"><code>preload.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Sometimes it is useful to be able to preload content into the app.
This can take a few forms. In the most basic you may want to save the
current analysis and reload it at a later date. Often you may have
standard analyses that you want to run when a dataset of a particular
format has been loaded. Lastly, you may want to set the app up so that
it starts with a bunch of preloaded content so the user can play around
with it. The following will outline how to do each of these tasks.</p>
<div class="section level3">
<h3 id="saving-and-loading-an-analysis">Saving and loading an analysis<a class="anchor" aria-label="anchor" href="#saving-and-loading-an-analysis"></a>
</h3>
<p>This is the most straightforward method but it is mentioned here
because it is the most likley way a user would set up the other two
scenarios below. You can load a dataset and populate any of the modules
with content like normal. Then you would go to the save analysis portion
of the app (under App State) and just select save. This should push a
zip file to you with the current analysis saved inside of ti. To reload
this analysis you can load the zip file and it should repopulate the
analysis for you. <strong>The key here is to refresh the app so it is
“empty” before loading it.</strong></p>
<p>If you open that zip file you will notice a file called
<code>preload.yaml</code> along with your original dataset. This yaml
file is needed below to create workflows and prelaod the app.</p>
</div>
<div class="section level3">
<h3 id="creating-automated-workflows">Creating automated workflows<a class="anchor" aria-label="anchor" href="#creating-automated-workflows"></a>
</h3>
<p>To create automated workflows you need one or more preload files. You
will deploy these along with the app. The first thing you will need to
do is create a copy of the app (or your own app) in the deployment
directory. You can do this using this command</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"formods"</span>,<span class="st">"templates"</span>, <span class="st">"FM_compact.R"</span><span class="op">)</span>, </span>
<span>          to   <span class="op">=</span> <span class="st">"App.R"</span><span class="op">)</span></span></code></pre></div>
<p>Certain features of the app behave differently depending on whether
it is running locally or deployed on a server. If you want to deploy the
app you need to tell the App it is deployed. This is done by creating an
empty file named DEPLOYED in the same directory as the deployed app
file. This is optional.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.create</a></span><span class="op">(</span><span class="st">"DEPLOYED"</span><span class="op">)</span></span></code></pre></div>
<p>If you look at the top of the <code>App.R</code> file you created you
will see something like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formods.yaml</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"formods"</span>,  <span class="st">"templates"</span>,  <span class="st">"formods.yaml"</span><span class="op">)</span></span>
<span><span class="va">ASM.yaml</span>      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"formods"</span>,  <span class="st">"templates"</span>,  <span class="st">"ASM.yaml"</span><span class="op">)</span></span>
<span><span class="va">UD.yaml</span>       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"formods"</span>,  <span class="st">"templates"</span>,  <span class="st">"UD.yaml"</span><span class="op">)</span></span>
<span><span class="va">DW.yaml</span>       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"formods"</span>,  <span class="st">"templates"</span>,  <span class="st">"DW.yaml"</span><span class="op">)</span></span>
<span><span class="va">FG.yaml</span>       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"formods"</span>,  <span class="st">"templates"</span>,  <span class="st">"FG.yaml"</span><span class="op">)</span></span></code></pre></div>
<p>These are the configuration files for each module. The workflow
information is stored in the <code>formods.yaml</code> file. You’ll need
to create a local version you can edit and fill with your workflow
information.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"formods"</span>, <span class="st">"templates"</span>,  <span class="st">"formods.yaml"</span><span class="op">)</span>,</span>
<span>          to   <span class="op">=</span> <span class="st">"myformods.yaml"</span><span class="op">)</span></span></code></pre></div>
<p>To make your app use this file you need to edit it and change the
assignment of the <code>formods.yaml</code> object:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">formods.yaml</span>       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"myformods.yaml"</span><span class="op">)</span></span></code></pre></div>
<p>When you alter these configuration file locations it is important to
give the full path.</p>
<p>If you edit the file <code>myformods.yaml</code> you will see a
section called workflows:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="at">  </span><span class="fu">workflows</span><span class="kw">:</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="at">    </span><span class="fu">example</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="at">      </span><span class="fu">group</span><span class="kw">:</span><span class="at">      </span><span class="st">"Examples"</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="at">      </span><span class="fu">desc</span><span class="kw">:</span><span class="at">       </span><span class="st">"Example Workflow"</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">      # Set to true if the workflow requires a dataset</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="at">      </span><span class="fu">require_ds</span><span class="kw">:</span><span class="at"> </span><span class="ch">TRUE</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">      # this can contain an aboslute path as a string or R evaluable code</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="at">      </span><span class="fu">preload</span><span class="kw">:</span><span class="at">    </span><span class="st">"file.path('.', 'example.yaml')"</span></span></code></pre></div>
<p>This is be a pre-populated example showing how to creaet a workflow.
You can create as many workflows as you want here by giving them
different names from example above (copy/paste example, change the name,
and alter the details). The group option will allow you to group your
workflows together in the selection form. The description
(<code>desc</code>) is a verbose description of the workflow and
<code>require_ds</code> indicates if the workflow depends on a dataset.
This should probably be true. The <code>preload</code> field points to
the yaml file that has the workflow details. This is the
<code>preload.yaml</code> file you will extract from the zip file
created when saving an analysis. You need to copy that file to the
deployment directory and rename it to whatever is referenced here
(e.g. <code>preload.yaml</code> to <code>example.yaml</code>).</p>
<p>Now you should have the following files in the directory:</p>
<ul>
<li>
<code>App.R</code>: App file edited to use the custom formods
configuration file.</li>
<li>
<code>DEPLOYED</code>: Empty file indicating the app is
deployed.</li>
<li>
<code>myformods.yaml</code>: Customized formods file to indicate the
available workflows</li>
<li>
<code>example.yaml</code>: Example workflow.</li>
</ul>
<p>If you set this up correctly and it finds at least one workflow yaml
file specified it should create a workflow selection element and button
to run the selected workflow in the data upload section of the app like
this:</p>
<div class="float">
<img src="run_workflow.png" width="200" alt="Workflow ui elements"><div class="figcaption">Workflow ui elements</div>
</div>
</div>
<div class="section level3">
<h3 id="preloading-the-app-with-content">Preloading the app with content<a class="anchor" aria-label="anchor" href="#preloading-the-app-with-content"></a>
</h3>
<p>First you need to unzip the contents of the save analysis into a
directory. Next, in the same directory where you unziped the contents of
the analysis, you need to create an app file and also create the
DEPLOYED file if you want to deploy the app. This will use the test app
that ships with <code>formods</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"formods"</span>,<span class="st">"templates"</span>, <span class="st">"FM_compact.R"</span><span class="op">)</span>, </span>
<span>          to   <span class="op">=</span> <span class="st">"App.R"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.create</a></span><span class="op">(</span><span class="st">"DEPLOYED"</span><span class="op">)</span></span></code></pre></div>
<p>Now when you run the app, the preload file will be detected and the
contents will be loaded into the app. This is done with the following
code in the app:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"preload.yaml"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">shinybusy</span><span class="fu">::</span><span class="fu"><a href="https://dreamrs.github.io/shinybusy/reference/modal-spinner.html" class="external-link">show_modal_spinner</a></span><span class="op">(</span>text<span class="op">=</span><span class="st">"Preloading analysis, be patient"</span>, session<span class="op">=</span><span class="va">session</span><span class="op">)</span></span>
<span>  <span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/FM_app_preload.html">FM_app_preload</a></span><span class="op">(</span>session<span class="op">=</span><span class="va">session</span>, sources<span class="op">=</span><span class="st">"preload.yaml"</span><span class="op">)</span></span>
<span>  <span class="fu">shinybusy</span><span class="fu">::</span><span class="fu"><a href="https://dreamrs.github.io/shinybusy/reference/modal-spinner.html" class="external-link">remove_modal_spinner</a></span><span class="op">(</span>session <span class="op">=</span> <span class="va">session</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by John Harrold.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
