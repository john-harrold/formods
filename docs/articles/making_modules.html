<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="formods">
<title>Making Modules • formods</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Making Modules">
<meta property="og:description" content="formods">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">formods</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--tutorials">
    <span class="fas fa fas fa-chalkboard-teacher"></span>
     
    Tutorials
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--tutorials">
    <a class="dropdown-item" href="../articles/included_modules.html">Included Modules</a>
    <a class="dropdown-item" href="../articles/making_modules.html">Making Modules</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fas fa fas fa-hat-wizard"></span>
     
    Functions
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">
    <span class="fas fa fas fa-rss"></span>
     
    News
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/john-harrold/formods/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="making_modules_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="making_modules_files/handsontable-6.2.2/handsontable.full.min.css" rel="stylesheet">
<script src="making_modules_files/handsontable-6.2.2/handsontable.full.min.js"></script><script src="making_modules_files/handsontable-6.2.2/all.min.js"></script><script src="making_modules_files/numbro.languages-2.0.6/languages.min.js"></script><script src="making_modules_files/chroma-1.3.3/chroma.min.js"></script><script src="making_modules_files/sparkline-2.1.2/jquery.sparkline.min.js"></script><link href="making_modules_files/rhandsontable-0.3.7/rhandsontable.css" rel="stylesheet">
<script src="making_modules_files/rhandsontable-binding-0.3.8/rhandsontable.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Making Modules</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/john-harrold/formods/blob/HEAD/vignettes/making_modules.Rmd" class="external-link"><code>vignettes/making_modules.Rmd</code></a></small>
      <div class="d-none name"><code>making_modules.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette will provide an overview of the formods framework for
creating reproducable modules that interact with each other. Each module
has its own namespace that is mantained by using a module short name as
a prefix for functions. For example the figure generation module uses
<code>FG</code>. If you want to create a module, please submit an issue
at the <a href="https://github.com/john-harrold/formods/issues" class="external-link">formods
github repository</a> with the following information:</p>
<ul>
<li>The short name you intend to use</li>
<li>A brief description of the module</li>
<li>A list of modules it depends on</li>
</ul>
<div class="section level3">
<h3 id="current-modules">Current modules<a class="anchor" aria-label="anchor" href="#current-modules"></a>
</h3>
<ul>
<li>ASM - <a href="https://formods.ubiquity.tools" class="external-link">App State
Management</a>
</li>
<li>DW - <a href="https://formods.ubiquity.tools" class="external-link">Data
Wrangling</a>
</li>
<li>FG - <a href="https://formods.ubiquity.tools" class="external-link">Figure
Generation</a>
</li>
<li>FM - <a href="https://formods.ubiquity.tools" class="external-link">Formods</a>
</li>
<li>UD - <a href="https://formods.ubiquity.tools" class="external-link">Upload Data</a>
</li>
</ul>
<p>The current modules are in development:</p>
<ul>
<li>NCA - <a href="https://github.com/john-harrold/ruminate" class="external-link">Non-Compartmental
Analysis</a>
</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="formods-framework">formods framework<a class="anchor" aria-label="anchor" href="#formods-framework"></a>
</h2>
<p>To get started you can make a copy of some example files:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"formods"</span>, <span class="st">"templates"</span>, <span class="st">"ZZ_module_components.R"</span><span class="op">)</span>, <span class="st">"ZZ_module_components.R"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"formods"</span>, <span class="st">"templates"</span>, <span class="st">"ZZ_Server.R"</span><span class="op">)</span>, <span class="st">"ZZ_Server.R"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"formods"</span>, <span class="st">"templates"</span>, <span class="st">"ZZ.yaml"</span><span class="op">)</span>, <span class="st">"ZZ.yaml"</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>
<code>ZZ_module_components.R</code> - An app that can be used for
testing the module and highlighting the different UI elements that are
used within the module.</li>
<li>
<code>ZZ_Server.R</code>: A bare bones file containing the expected
functions and their minimal inputs.</li>
<li>
<code>ZZ.yaml</code>: This module configuration file contains the
the minimal elements expected, but you can add your own fields to suit
your modules needs.</li>
</ul>
<p>You can rename the <code>ZZ</code> portion of the files with the
module short name you’re using. The <code>ZZ_Server.R</code> would go in
the <code>R</code> directory in your package and the other two files
would go into <code>inst/templates</code>.</p>
</div>
<div class="section level2">
<h2 id="expected-functions">Expected functions<a class="anchor" aria-label="anchor" href="#expected-functions"></a>
</h2>
<p>For the module to work and interact with other modules, there are
certain funcitons that are expected.</p>
<ul>
<li>
<code>ZZ_Server</code> Shiny server function.</li>
<li>
<code>ZZ_init_state</code> Creates an empty the formods state for
the module.</li>
<li>
<code>ZZ_fetch_state</code> Each module has a function to fetch the
state. Within this function there should be no interactivity. Any access
of the elements to the Shiny input should be isolated. Based on
differences between the input elements (current state of the app) and
the stored app state can be used to trigger different things.</li>
<li>
<code>ZZ_fetch_code</code> This takes as it’s first argument the
module state. When called with only this argument it should return a
character object containing all of the code needed to generate the
elements of this module represented in the app. You can assume that any
modules this one depends on will be defined previously. For example the
<code>FG</code> module will return only that code associated with
generating figures. It will be appended to the code from the
<code>UD</code> and <code>DW</code> modules that define loading the
dataset and creation of the data views. For modules where no code is
generated (e.g. <code>ASM</code>) just return <code>NULL</code>.</li>
<li>
<code>ZZ_append_report</code><br>
</li>
<li>
<code>ZZ_fetch_ds</code> If a module provides data sets to be used
in other modules you need to create this function. It should return at
least the following:
<ul>
<li>
<code>hasds</code> Boolean variable indicating if the modules
currently has any exportable datasets.</li>
<li>
<code>isgood</code> General return status of the funciton. Set to
FALSE if any errors were encoutered.</li>
<li>
<code>msgs</code> A character vector of any messages to pass back to
the user.</li>
<li>
<code>ds</code> A module can provide multiple datasets. This is a
list with the following elements for each dataset:
<ul>
<li>
<code>label</code> Text label for the dataset</li>
<li>
<code>MOD_TYPE</code> Short name for the type of module.</li>
<li>
<code>id</code> module ID.</li>
<li>
<code>DS</code> Dataframe containing the actual dataset.</li>
<li>
<code>DSMETA</code> Metadata describing DS.</li>
<li>
<code>code</code> Complete code to build dataset.</li>
<li>
<code>checksum</code> Module checksum.</li>
<li>
<code>DSchecksum</code> Dataset checksum.</li>
</ul>
</li>
</ul>
</li>
<li>
<code>ZZ_test_mksession</code> When testing outside of Shiny it is
useful to have a prepopulated session, intput, etc objects with actual
data. Each module shoudl have a <code>test_mksession</code> function
that populates these objects with useful data. If your module depends on
a different module, you can use the <code>test_mksession</code> for the
modyou yours depends on. For example the data wrangling module depends
on the upload data module. So the <code>DW_test_mksession</code>
function uses <code>UD_test_mksession</code> internally to load the test
dataset and then builds on top of that. The function should return the
following:
<ul>
<li>
<code>isgood</code> Boolean indicating the exit status of the
function.</li>
<li>
<code>session</code> The value Shiny session variable (in app) or a
list (outside of app) after initialization.</li>
<li>
<code>input</code> The value of the shiny input at the end of the
session initialization.</li>
<li>
<code>state</code> App state.</li>
<li>
<code>rsc</code> The <code>react_state</code> components.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="expected-ui-elements">Expected UI elements<a class="anchor" aria-label="anchor" href="#expected-ui-elements"></a>
</h2>
<ul>
<li><code>ui_zz_compact</code></li>
</ul>
</div>
<div class="section level2">
<h2 id="module-interaction">Module interaction<a class="anchor" aria-label="anchor" href="#module-interaction"></a>
</h2>
<p>Say you are using the UD module to feed data into the DW module and
the user goes back to the upload form and uploads a different data set.
This will need to trigger a reset of the Data Wrangling module as well
as tell your larger app that something has changed.</p>
<div class="section level3">
<h3 id="module-state-and-reacting-to-changes">Module state and reacting to changes<a class="anchor" aria-label="anchor" href="#module-state-and-reacting-to-changes"></a>
</h3>
<p>Changes in module states are detected with the
<code>react_state</code> object. For a given module of type
<code>"XX"</code> with a module id of <code>"ID"</code> you would detect
changes by reacting to <code>react_state[["ID"]]</code> and looking for
changes in the checksum element below:</p>
<p><code>react_state[["ID"]][["XX"]][["checksum"]]</code></p>
<ul>
<li>
<code>checksum</code> A checksum that can be used to detect changes
in this module. For example in the UD module this will change if the
uploaded file or the sheet selected from a currently uplo:waded file
changes.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="helper-functions-in-formods">Helper functions in formods<a class="anchor" aria-label="anchor" href="#helper-functions-in-formods"></a>
</h2>
<ul>
<li>
<code><a href="../reference/FM_le.html">FM_le()</a></code> - Creates log entries (<code>le</code>) that
are displayed in the console.</li>
<li>
<code><a href="../reference/FM_tc.html">FM_tc()</a></code> - This can be used to evaluate code, trap
errors, and process results.</li>
<li><code><a href="../reference/has_changed.html">has_changed()</a></code></li>
<li>
<code><a href="../reference/set_hold.html">set_hold()</a></code> - Used to set a hold on one or more UI
elements. This prevents internal updating of that UI element based on
the current value in the App.</li>
<li>
<code><a href="../reference/fetch_hold.html">fetch_hold()</a></code> - This will retrieve the hold status of a
UI element.</li>
<li>
<code><a href="../reference/remove_hold.html">remove_hold()</a></code> - This will remove any holds set on a UI
element.</li>
<li>‘FM_build_comment()’ - This creates comments from strings so they
will form sections when viewed in RStudio.</li>
<li>
<code><a href="../reference/FM_add_ui_tooltip.html">FM_add_ui_tooltip()</a></code> - Attaches a tooltip to a UI
element.</li>
<li>
<code><a href="../reference/FM_init_state.html">FM_init_state()</a></code> - Called at the top of your module
state initialization function to create a skeleton of a module state
that you can then build upon.</li>
<li>
<code><a href="../reference/FM_set_notification.html">FM_set_notification()</a></code> - Within you code you can create
notifications and attach them to a module state.</li>
<li>
<code><a href="../reference/FM_notify.html">FM_notify()</a></code> - Used in <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent()</a></code> to
show notifications that have not yet been displayed.</li>
<li><code><a href="../reference/FM_set_mod_state.html">FM_set_mod_state()</a></code></li>
<li><code><a href="../reference/FM_fetch_mod_state.html">FM_fetch_mod_state()</a></code></li>
<li><code><a href="../reference/FM_set_ui_msg.html">FM_set_ui_msg()</a></code></li>
<li>
<code><a href="../reference/FM_pretty_sort.html">FM_pretty_sort()</a></code> - Used as a general sorting function
that will try to make the sorted results prettier.</li>
<li>
<code><a href="../reference/FM_pause_screen.html">FM_pause_screen()</a></code> - Pauses the screen when doing
something on the server side that takes a while.</li>
<li>
<code><a href="../reference/FM_resume_screen.html">FM_resume_screen()</a></code> - Resumes activity (unpauses the
screen) when you’re done with the pause.</li>
<li>
<code><a href="../reference/FM_fetch_data_format.html">FM_fetch_data_format()</a></code> - Creates formatting information
for display for a given data frame.</li>
</ul>
<p>The examples below require a Shiny session variable and a formods
state object. Here we create some examples and other objects needed to
demonstrate the functions below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://formods.ubiquity.tools/" class="external-link">formods</a></span><span class="op">)</span></span>
<span><span class="co"># This creates the state and session objects</span></span>
<span><span class="va">sess_res</span> <span class="op">=</span> <span class="fu"><a href="../reference/UD_test_mksession.html">UD_test_mksession</a></span><span class="op">(</span>session<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; → UD: including file</span></span>
<span><span class="co">#&gt; → UD:   source: file.path(system.file(package="onbrand"), "templates", "report.docx")</span></span>
<span><span class="co">#&gt; → UD:   dest:   file.path("config","report.docx")</span></span>
<span><span class="co">#&gt; → UD: including file</span></span>
<span><span class="co">#&gt; → UD:   source: file.path(system.file(package="onbrand"), "templates", "report.pptx")</span></span>
<span><span class="co">#&gt; → UD:   dest:   file.path("config","report.pptx")</span></span>
<span><span class="co">#&gt; → UD: including file</span></span>
<span><span class="co">#&gt; → UD:   source: file.path(system.file(package="onbrand"), "templates", "report.yaml")</span></span>
<span><span class="co">#&gt; → UD:   dest:   file.path("config","report.yaml")</span></span>
<span><span class="co">#&gt; → UD: State initialized</span></span>
<span><span class="co">#&gt; → UD: module checksum updated:897d952fecbc804999396a96f9df4b20</span></span>
<span><span class="va">state</span>    <span class="op">=</span> <span class="va">sess_res</span><span class="op">$</span><span class="va">state</span></span>
<span><span class="va">session</span>  <span class="op">=</span> <span class="va">sess_res</span><span class="op">$</span><span class="va">session</span></span>
<span></span>
<span><span class="co"># Here we load an example dataset into the df object.</span></span>
<span><span class="va">data_file_local</span> <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package<span class="op">=</span><span class="st">"formods"</span>, <span class="st">"test_data"</span>, <span class="st">"TEST_DATA.xlsx"</span><span class="op">)</span></span>
<span><span class="va">sheet</span>           <span class="op">=</span> <span class="st">"DATA"</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span>path<span class="op">=</span><span class="va">data_file_local</span>, sheet<span class="op">=</span><span class="va">sheet</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="setting-holds-on-ui-elements">Setting holds on UI elements<a class="anchor" aria-label="anchor" href="#setting-holds-on-ui-elements"></a>
</h3>
<p>The mechanics of the fetch state functions mean that each time a
fetch state is called, all of the UI elements in the App are pulled and
placed in the app state. This generally works well with some exceptions.
The main exception is when you want to have a UI element that changes
another UI element. Say for example you have a selection box with a UI
id of <code>my_selection</code>. You want that selection to alter a text
input with an id of <code>my_text</code>. However if you just poll the
ui elements you may update <code>my_text</code> based on changes to
<code>my_selection</code> then have those overwritten by the current
value of <code>my_text</code>. To prevent this, you need to do two
things:</p>
<ul>
<li>When processing <code>my_selection</code> you need to set a hold on
<code>my_text</code> (done with <code><a href="../reference/set_hold.html">set_hold()</a></code>).</li>
<li>When processing <code>my_text</code> you need to do that <em>only if
there is no hold set</em>. This is checked with
<code><a href="../reference/fetch_hold.html">fetch_hold()</a></code>
</li>
</ul>
<p>Lastly you need to remove the hold. This is done after the UI has
refreshed with the new text value populated in to <code>my_text</code>
(with the appropriate reactions set). This is done with an observeEvent
that is triggered after everything else (with a priority of -100
below):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">remove_hold_listen</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">my_selection</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="fu">remove_hold_listen</span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>  <span class="co"># Once the UI has been regenerated we</span></span>
<span>  <span class="co"># remove any holds for this module</span></span>
<span>  <span class="va">state</span> <span class="op">=</span> <span class="fu">XX_fetch_state</span><span class="op">(</span>id              <span class="op">=</span> <span class="va">id</span>,</span>
<span>                         input           <span class="op">=</span> <span class="va">input</span>,</span>
<span>                         session         <span class="op">=</span> <span class="va">session</span>,</span>
<span>                         FM_yaml_file    <span class="op">=</span> <span class="va">FM_yaml_file</span>,</span>
<span>                         MOD_yaml_file   <span class="op">=</span> <span class="va">MOD_yaml_file</span>,</span>
<span>                         react_state     <span class="op">=</span> <span class="va">react_state</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/FM_le.html">FM_le</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"removing holds"</span><span class="op">)</span></span>
<span>  <span class="co"># Removing all holds</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">hname</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">state</span><span class="op">[[</span><span class="st">"XX"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="st">"ui_hold"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/remove_hold.html">remove_hold</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">session</span>, <span class="va">hname</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span>, priority <span class="op">=</span> <span class="op">-</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>The <code>remove_hold_listen</code> object should contain all of the
inputs that are… holdable?</p>
</div>
<div class="section level3">
<h3 id="dataframe-formatting-information">Dataframe formatting information<a class="anchor" aria-label="anchor" href="#dataframe-formatting-information"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hfmt</span> <span class="op">=</span> <span class="fu"><a href="../reference/FM_fetch_data_format.html">FM_fetch_data_format</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">state</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Descriptive headers </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span> <span class="va">hfmt</span><span class="op">[[</span><span class="st">"col_heads"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "&lt;span style='color:#3C8DBC'&gt;&lt;b&gt;ID&lt;/b&gt;&lt;br/&gt;&lt;font size='-3'&gt;num&lt;/font&gt;&lt;/span&gt;"      </span></span>
<span><span class="co">#&gt; [2] "&lt;span style='color:#3C8DBC'&gt;&lt;b&gt;TIME_DY&lt;/b&gt;&lt;br/&gt;&lt;font size='-3'&gt;num&lt;/font&gt;&lt;/span&gt;" </span></span>
<span><span class="co">#&gt; [3] "&lt;span style='color:#3C8DBC'&gt;&lt;b&gt;TIME_HR&lt;/b&gt;&lt;br/&gt;&lt;font size='-3'&gt;num&lt;/font&gt;&lt;/span&gt;" </span></span>
<span><span class="co">#&gt; [4] "&lt;span style='color:#3C8DBC'&gt;&lt;b&gt;NTIME_DY&lt;/b&gt;&lt;br/&gt;&lt;font size='-3'&gt;num&lt;/font&gt;&lt;/span&gt;"</span></span>
<span><span class="co">#&gt; [5] "&lt;span style='color:#3C8DBC'&gt;&lt;b&gt;NTIME_HR&lt;/b&gt;&lt;br/&gt;&lt;font size='-3'&gt;num&lt;/font&gt;&lt;/span&gt;"</span></span>
<span><span class="co">#&gt; [6] "&lt;span style='color:#3C8DBC'&gt;&lt;b&gt;TIME&lt;/b&gt;&lt;br/&gt;&lt;font size='-3'&gt;num&lt;/font&gt;&lt;/span&gt;"</span></span>
<span></span>
<span><span class="co"># Subtext</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span> <span class="va">hfmt</span><span class="op">[[</span><span class="st">"col_subtext"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "num: 1,⋅⋅⋅,360"  "num: 0,⋅⋅⋅,84"   "num: 0,⋅⋅⋅,2016" "num: 0,⋅⋅⋅,42"  </span></span>
<span><span class="co">#&gt; [5] "num: 0,⋅⋅⋅,1008" "num: 0,⋅⋅⋅,2016"</span></span></code></pre></div>
<p>The custom headers can be used with the <a href="http://jrowen.github.io/rhandsontable/" class="external-link">rhandsontable</a>
package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hot</span> <span class="op">=</span> <span class="fu">rhandsontable</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rhandsontable/man/rhandsontable.html" class="external-link">rhandsontable</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,</span>
<span>  width      <span class="op">=</span> <span class="st">"100%"</span>,</span>
<span>  height     <span class="op">=</span> <span class="st">"100%"</span>,</span>
<span>  colHeaders <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">hfmt</span><span class="op">[[</span><span class="st">"col_heads"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  rowHeaders <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div id="htmlwidget-b107717ca322a341e8ee" style="width:100%;height:100%;" class="rhandsontable html-widget "></div>
<script type="application/json" data-for="htmlwidget-b107717ca322a341e8ee">{"x":{"data":[{"ID":1,"TIME_DY":0,"TIME_HR":0,"NTIME_DY":0,"NTIME_HR":0,"TIME":0,"AMT":3000000,"DV":0,"RECDESC":"dose","DOSE":3000000,"DOSE_STR":"3 mg","Cohort":"SD 3 mg IV","ROUTE":"IV","WT":67.9,"SUBTYPE":"PT","SEX":"Female","F1":0.744,"ka":0.449,"CL":0.25,"Vc":3.67,"Vp":3.77,"Q":0.325,"BM_IC":1250,"kdeg_BM":0.1,"Emax":190,"EC50":300,"CMT":"Ac","DUR":0,"EVID":1,"NDose":"SD","DOSE_NUM":1,"SUBTYPE_ID":1,"SEX_ID":1},{"ID":1,"TIME_DY":0,"TIME_HR":0,"NTIME_DY":0,"NTIME_HR":0,"TIME":0,"AMT":0,"DV":1250,"RECDESC":"BM_ng_ml","DOSE":3000000,"DOSE_STR":"3 mg","Cohort":"SD 3 mg IV","ROUTE":"IV","WT":67.9,"SUBTYPE":"PT","SEX":"Female","F1":0.744,"ka":0.449,"CL":0.25,"Vc":3.67,"Vp":3.77,"Q":0.325,"BM_IC":1250,"kdeg_BM":0.1,"Emax":190,"EC50":300,"CMT":"BM_ng_ml","DUR":0,"EVID":0,"NDose":"SD","DOSE_NUM":1,"SUBTYPE_ID":1,"SEX_ID":1},{"ID":1,"TIME_DY":0,"TIME_HR":0,"NTIME_DY":0,"NTIME_HR":0,"TIME":0,"AMT":0,"DV":0,"RECDESC":"C_ng_ml","DOSE":3000000,"DOSE_STR":"3 mg","Cohort":"SD 3 mg IV","ROUTE":"IV","WT":67.9,"SUBTYPE":"PT","SEX":"Female","F1":0.744,"ka":0.449,"CL":0.25,"Vc":3.67,"Vp":3.77,"Q":0.325,"BM_IC":1250,"kdeg_BM":0.1,"Emax":190,"EC50":300,"CMT":"C_ng_ml","DUR":0,"EVID":0,"NDose":"SD","DOSE_NUM":1,"SUBTYPE_ID":1,"SEX_ID":1},{"ID":1,"TIME_DY":1,"TIME_HR":24,"NTIME_DY":1,"NTIME_HR":24,"TIME":24,"AMT":0,"DV":1647,"RECDESC":"BM_ng_ml","DOSE":3000000,"DOSE_STR":"3 mg","Cohort":"SD 3 mg IV","ROUTE":"IV","WT":67.9,"SUBTYPE":"PT","SEX":"Female","F1":0.744,"ka":0.449,"CL":0.25,"Vc":3.67,"Vp":3.77,"Q":0.325,"BM_IC":1250,"kdeg_BM":0.1,"Emax":190,"EC50":300,"CMT":"BM_ng_ml","DUR":0,"EVID":0,"NDose":"SD","DOSE_NUM":1,"SUBTYPE_ID":1,"SEX_ID":1},{"ID":1,"TIME_DY":1,"TIME_HR":24,"NTIME_DY":1,"NTIME_HR":24,"TIME":24,"AMT":0,"DV":690.5,"RECDESC":"C_ng_ml","DOSE":3000000,"DOSE_STR":"3 mg","Cohort":"SD 3 mg IV","ROUTE":"IV","WT":67.9,"SUBTYPE":"PT","SEX":"Female","F1":0.744,"ka":0.449,"CL":0.25,"Vc":3.67,"Vp":3.77,"Q":0.325,"BM_IC":1250,"kdeg_BM":0.1,"Emax":190,"EC50":300,"CMT":"C_ng_ml","DUR":0,"EVID":0,"NDose":"SD","DOSE_NUM":1,"SUBTYPE_ID":1,"SEX_ID":1},{"ID":1,"TIME_DY":2,"TIME_HR":48,"NTIME_DY":2,"NTIME_HR":48,"TIME":48,"AMT":0,"DV":1947,"RECDESC":"BM_ng_ml","DOSE":3000000,"DOSE_STR":"3 mg","Cohort":"SD 3 mg IV","ROUTE":"IV","WT":67.9,"SUBTYPE":"PT","SEX":"Female","F1":0.744,"ka":0.449,"CL":0.25,"Vc":3.67,"Vp":3.77,"Q":0.325,"BM_IC":1250,"kdeg_BM":0.1,"Emax":190,"EC50":300,"CMT":"BM_ng_ml","DUR":0,"EVID":0,"NDose":"SD","DOSE_NUM":1,"SUBTYPE_ID":1,"SEX_ID":1}],"rClass":["tbl_df","tbl","data.frame"],"rColClasses":{"ID":"numeric","TIME_DY":"numeric","TIME_HR":"numeric","NTIME_DY":"numeric","NTIME_HR":"numeric","TIME":"numeric","AMT":"numeric","DV":"numeric","RECDESC":"character","DOSE":"numeric","DOSE_STR":"character","Cohort":"character","ROUTE":"character","WT":"numeric","SUBTYPE":"character","SEX":"character","F1":"numeric","ka":"numeric","CL":"numeric","Vc":"numeric","Vp":"numeric","Q":"numeric","BM_IC":"numeric","kdeg_BM":"numeric","Emax":"numeric","EC50":"numeric","CMT":"character","DUR":"numeric","EVID":"numeric","NDose":"character","DOSE_NUM":"numeric","SUBTYPE_ID":"numeric","SEX_ID":"numeric"},"rColnames":["ID","TIME_DY","TIME_HR","NTIME_DY","NTIME_HR","TIME","AMT","DV","RECDESC","DOSE","DOSE_STR","Cohort","ROUTE","WT","SUBTYPE","SEX","F1","ka","CL","Vc","Vp","Q","BM_IC","kdeg_BM","Emax","EC50","CMT","DUR","EVID","NDose","DOSE_NUM","SUBTYPE_ID","SEX_ID"],"rColHeaders":["ID","TIME_DY","TIME_HR","NTIME_DY","NTIME_HR","TIME","AMT","DV","RECDESC","DOSE","DOSE_STR","Cohort","ROUTE","WT","SUBTYPE","SEX","F1","ka","CL","Vc","Vp","Q","BM_IC","kdeg_BM","Emax","EC50","CMT","DUR","EVID","NDose","DOSE_NUM","SUBTYPE_ID","SEX_ID"],"rRowHeaders":null,"rDataDim":[6,33],"selectCallback":false,"colHeaders":["<span style='color:#3C8DBC'><b>ID<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>TIME_DY<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>TIME_HR<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>NTIME_DY<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>NTIME_HR<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>TIME<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>AMT<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>DV<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#DD4B39'><b>RECDESC<\/b><br/><font size='-3'>text<\/font><\/span>","<span style='color:#3C8DBC'><b>DOSE<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#DD4B39'><b>DOSE_STR<\/b><br/><font size='-3'>text<\/font><\/span>","<span style='color:#DD4B39'><b>Cohort<\/b><br/><font size='-3'>text<\/font><\/span>","<span style='color:#DD4B39'><b>ROUTE<\/b><br/><font size='-3'>text<\/font><\/span>","<span style='color:#3C8DBC'><b>WT<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#DD4B39'><b>SUBTYPE<\/b><br/><font size='-3'>text<\/font><\/span>","<span style='color:#DD4B39'><b>SEX<\/b><br/><font size='-3'>text<\/font><\/span>","<span style='color:#3C8DBC'><b>F1<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>ka<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>CL<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>Vc<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>Vp<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>Q<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>BM_IC<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>kdeg_BM<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>Emax<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>EC50<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#DD4B39'><b>CMT<\/b><br/><font size='-3'>text<\/font><\/span>","<span style='color:#3C8DBC'><b>DUR<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>EVID<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#DD4B39'><b>NDose<\/b><br/><font size='-3'>text<\/font><\/span>","<span style='color:#3C8DBC'><b>DOSE_NUM<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>SUBTYPE_ID<\/b><br/><font size='-3'>num<\/font><\/span>","<span style='color:#3C8DBC'><b>SEX_ID<\/b><br/><font size='-3'>num<\/font><\/span>"],"rowHeaders":null,"columns":[{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null},{"type":"numeric","numericFormat":{"pattern":"0.00"},"renderer":"customRenderer","default":null}],"width":"100%","height":"100%","debug":0,"search":false,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep3":{"name":"---------"},"undo":[],"redo":[],"hsep4":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer","columns.5.renderer","columns.6.renderer","columns.7.renderer","columns.8.renderer","columns.9.renderer","columns.10.renderer","columns.11.renderer","columns.12.renderer","columns.13.renderer","columns.14.renderer","columns.15.renderer","columns.16.renderer","columns.17.renderer","columns.18.renderer","columns.19.renderer","columns.20.renderer","columns.21.renderer","columns.22.renderer","columns.23.renderer","columns.24.renderer","columns.25.renderer","columns.26.renderer","columns.27.renderer","columns.28.renderer","columns.29.renderer","columns.30.renderer","columns.31.renderer","columns.32.renderer"],"jsHooks":[]}</script><p>To add subtext to a selection widget in Shiny you need to use the
<a href="https://github.com/dreamRs/shinyWidgets" class="external-link">shinyWidgets</a> package.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sel_subtext</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span> <span class="va">hfmt</span><span class="op">[[</span><span class="st">"col_subtext"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dreamRs/shinyWidgets" class="external-link">shinyWidgets</a></span><span class="op">)</span></span>
<span><span class="fu">shinyWidgets</span><span class="fu">::</span><span class="fu"><a href="https://dreamrs.github.io/shinyWidgets/reference/pickerInput.html" class="external-link">pickerInput</a></span><span class="op">(</span></span>
<span>    inputId    <span class="op">=</span> <span class="st">"select_example"</span>,</span>
<span>    choices    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,</span>
<span>    label      <span class="op">=</span> <span class="st">"Select with subtext"</span>,</span>
<span>    choicesOpt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>subtext <span class="op">=</span> <span class="va">sel_subtext</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To alter the formats shown here you need to edit the
<code>formods.yaml</code> configuration file and look at the
<code>FM</code><span class="math inline">\(\rightarrow\)</span><code>data_meta</code>
section.</p>
</div>
<div class="section level3">
<h3 id="notifications">Notifications<a class="anchor" aria-label="anchor" href="#notifications"></a>
</h3>
<p>Notifications are created using the <a href="https://github.com/dreamRs/shinybusy" class="external-link">shinybusy</a> package
and are produced with two different functions:
<code><a href="../reference/FM_set_notification.html">FM_set_notification()</a></code> and <code><a href="../reference/FM_notify.html">FM_notify()</a></code>. This is
done in a centralized fashion where notifications are added to the state
object as user information is processed. This will set a notification
called <code>Example Notification</code>. Along with that a timestamp is
set:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>   <span class="va">state</span> <span class="op">=</span> <span class="fu"><a href="../reference/FM_set_notification.html">FM_set_notification</a></span><span class="op">(</span><span class="va">state</span>, <span class="st">"Something happened"</span>, <span class="st">"Example Notification"</span><span class="op">)</span></span></code></pre></div>
<p>That timestamp is used to track and prevent the notification from
being shown multiple times. Next you need to setup the reactions to
display the notifications. Here you can create a reactive expression of
the inputs that will lead to a notification:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">toNotify</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">reactive</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">input1</span>,</span>
<span>           <span class="va">input</span><span class="op">$</span><span class="va">input2</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Next you use <code><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent()</a></code> with that reactive
expression to trigger notifications. You need to use the fetch state
function for that molecule to get the state object with the
notifications. Then <code><a href="../reference/FM_notify.html">FM_notify()</a></code> will be called an any
unprocessed notifications will be displayed:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="fu">toNotify</span><span class="op">(</span><span class="op">)</span>, <span class="op">{</span></span>
<span>      <span class="va">state</span> <span class="op">=</span> <span class="fu">XX_fetch_state</span><span class="op">(</span>id              <span class="op">=</span> <span class="va">id</span>,</span>
<span>                             input           <span class="op">=</span> <span class="va">input</span>,</span>
<span>                             session         <span class="op">=</span> <span class="va">session</span>,</span>
<span>                             FM_yaml_file    <span class="op">=</span> <span class="va">FM_yaml_file</span>,</span>
<span>                             MOD_yaml_file   <span class="op">=</span> <span class="va">MOD_yaml_file</span>,</span>
<span>                             react_state     <span class="op">=</span> <span class="va">react_state</span><span class="op">)</span></span>
<span></span>
<span>      <span class="co"># Triggering optional notifications</span></span>
<span>      <span class="va">notify_res</span> <span class="op">=</span></span>
<span>      <span class="fu"><a href="../reference/FM_notify.html">FM_notify</a></span><span class="op">(</span>state    <span class="op">=</span> <span class="va">state</span>,</span>
<span>                session  <span class="op">=</span> <span class="va">session</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-tooltips">Adding tooltips<a class="anchor" aria-label="anchor" href="#adding-tooltips"></a>
</h3>
<p>Tooltips are created interally using the suggested
<a href="https://github.com/etiennebacher/prompter" class="external-link">prompter</a> package. To add a tool tip to a ui element you
would use the <code><a href="../reference/FM_add_ui_tooltip.html">FM_add_ui_tooltip()</a></code> function. For example to
add the tool tip, <code>You need to type harder!</code> to a text input
you would do the following:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uiele</span> <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/textInput.html" class="external-link">textInput</a></span><span class="op">(</span></span>
<span>          inputId <span class="op">=</span> <span class="st">"some_text"</span>, </span>
<span>          label   <span class="op">=</span> <span class="st">"You need to type harder!"</span><span class="op">)</span></span>
<span><span class="va">uiele</span> <span class="op">=</span> <span class="fu"><a href="../reference/FM_add_ui_tooltip.html">FM_add_ui_tooltip</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">uiele</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pausing-the-screen">Pausing the screen<a class="anchor" aria-label="anchor" href="#pausing-the-screen"></a>
</h3>
<p>To pause the screen the <a href="https://github.com/dreamRs/shinybusy" class="external-link">shinybusy</a> package is also
used. This is controlled with two functions:
<code><a href="../reference/FM_pause_screen.html">FM_pause_screen()</a></code> is used to pause the screen and/or update
the pause message, and <code><a href="../reference/FM_resume_screen.html">FM_resume_screen()</a></code> is used end the
pause and resume interaction with the user.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/FM_pause_screen.html">FM_pause_screen</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">session</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/FM_resume_screen.html">FM_resume_screen</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">session</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="formods-state-objects">formods state objects<a class="anchor" aria-label="anchor" href="#formods-state-objects"></a>
</h2>
<p>When you create a formods state object it can have the following
fields:</p>
<ul>
<li>
<code>yaml</code>- Contents of the formods configuration file.</li>
<li>
<code>MC</code> - Contents of the module configuration file.</li>
<li>
<code>XX</code> - XX here is the short name of the current module.
<code>MOD_TYPE</code> below), this is where you would store any app
information. (see below).</li>
<li>
<code>MOD_TYPE</code> - Short name of the module.</li>
<li>
<code>id</code> - ID of the module.</li>
<li>
<code>FM_yaml_file</code> - formods configuration file.</li>
<li>
<code>MOD_yaml_file</code> - Module configuration file.</li>
<li>
<code>notifications</code> - Contains notifications set by the user
through <code><a href="../reference/FM_set_notification.html">FM_set_notification()</a></code>.</li>
</ul>
<div class="section level3">
<h3 id="app-information-in-xx">App information in XX<a class="anchor" aria-label="anchor" href="#app-information-in-xx"></a>
</h3>
<p>This field <code>state$XX</code> is relatively free form but there
are some expected elements. JMH Add expected fields here.</p>
</div>
<div class="section level3">
<h3 id="configuration-file">Configuration file<a class="anchor" aria-label="anchor" href="#configuration-file"></a>
</h3>
<style type="text/css">
.scroll-100 {
  max-height: 100px;
  overflow-y: auto;
  background-color: inherit;
}
</style>
</div>
</div>
<div class="section level2">
<h2 class="tabset" id="yaml-configuration-files">YAML configuration files<a class="anchor" aria-label="anchor" href="#yaml-configuration-files"></a>
</h2>
<pre><code># https://www.glyphicons.com/sets/basic/
#General formods (FM) configuration across modules
FM: 
  include:
    files:
    - file:
        source: 'file.path(system.file(package="onbrand"), "templates", "report.docx")'
        dest:   'file.path("config","report.docx")'
    - file:
        source: 'file.path(system.file(package="onbrand"), "templates", "report.pptx")'
        dest:   'file.path("config","report.pptx")'
    - file:
        source: 'file.path(system.file(package="onbrand"), "templates", "report.yaml")'
        dest:   'file.path("config","report.yaml")'
  # Some features (e.g. copy to clipboard) don't work when deployed
  deployed: FALSE
  #General code options for the modules
  code: 
    theme:           "vibrant_ink"    
    showLineNumbers: TRUE
    # File name of the R script to contain generation code
    gen_file: run_analysis.R   
    # This is the preamble used in script generation. It goes on the
    # top. Feel free to add to it if you need to. Note that packages should be
    # listed in the packages section at the same level. 
    gen_preamble: |-
      # formods automated output ------------------------------------------------
      # https://formods.ubiquity.tools/
      rm(list=ls())
    # Each module should have a packages section that lists the packages
    # needed for code genereated for that module. 
    packages: ["onbrand", "writexl"]
  notifications:
    config:
      # You can put any arguments here that would be arguments for
      # config_notify(). See ?shinybusy::config_notify() for more information
      success:
        useFontAwesome: FALSE
        useIcon:        FALSE
        background:     "#5bb85b"
      failure:
        useFontAwesome: FALSE
        useIcon:        FALSE
        background:     "#d9534f"
      info:
        useFontAwesome: FALSE
        useIcon:        FALSE
        background:     "#5bc0de"
      warning:
        useFontAwesome: FALSE
        useIcon:        FALSE
        background:     "#f0ac4d"
  reporting: 
    # enabled here controls reporting for the app. Individual modules can be
    # controlled in their respective configuration files
    enabled: TRUE
    # The content_init section is used to initialize reports. You shouldn't
    # change the xlsx rpt but the docx and pptx rpt can be altered to
    # use custom onbrand templates. The main thing is that you create an
    # object called rpt with the appropriate template type in it. You can
    # also do any preprocessing here as well such as adding default content or
    # doing any placeholder assignments you might want to use. The paths can
    # be absolute paths. If relative paths are used they will be relative to
    # the user directory (either the temp formods directory running in shiny
    # or the top level of the zip file structure when saving the app state).
    content_init:
      xlsx: |-
           rpt = list(summary = NULL,
                      sheets  = list())
      docx: |-
           rpt  = onbrand::read_template(
             template = file.path("config", "report.docx"),
             mapping  = file.path("config", "report.yaml"))
      pptx: |-
           rpt  = onbrand::read_template(
             template = file.path("config", "report.pptx"),
             mapping  = file.path("config", "report.yaml"))
  ui:
    # See ?actionBttn for styles
    button_style: "fill"
    # Max size for picker inputs
    select_size:  10
    color_green:  "#00BB8A"
    color_red:    "#FF475E"
    color_blue:   "#0088FF"
    color_purple: "#bd2cf4"

  data_meta:
    # This controls the overall format of headers and the select subtext for
    # data frames with the following placeholders surrouned by ===:
    # COLOR  - font color
    # NAME   - colum name
    # LABEL  - type label
    # RANGE  - this depends on the nature of the data in the column:
    #        - If there are between 1 and 3 values then those values are shown.
    #        - If there are more than 3 values then the min and max are show.
    data_header:  "&lt;span style='color:===COLOR==='&gt;&lt;b&gt;===NAME===&lt;/b&gt;&lt;br/&gt;&lt;font size='-3'&gt;===LABEL===&lt;/font&gt;&lt;/span&gt;"
    subtext:      "===LABEL===: ===RANGE==="
    # Separator when showing more than three in a column. For exmaple if you
    # had a dataset with 1,2,3,4,5,6 and many_sep was ",...," then it would
    # appear as "1,...,6"
    many_sep: ",⋅⋅⋅," 
    # This controls the differences for different data types. Take the output
    # of typeof(df$colname) and put an entry for that output here. 
    data_types:
      character:   
        color:    "#DD4B39"
        label:    "text"
      double:         
        color:    "#3C8DBC"
        label:    "num"
      integer:        
        color:    "#3C8DBC"
        label:    "num"
      other:          
        color:    "black"
        label:    "other"
  labels:
    # JMH remove this once the datset stuff has been moved over
    default_ds:   "Original data set"
  user_files:
    use_tmpdir:     TRUE
  logging:
    enabled:        TRUE
    timestamp:      TRUE
    timestamp_fmt: "%Y-%m-%d %H:%M:%S"
    log_file:      "formods_log.txt"
    console:       TRUE</code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by John Harrold.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
